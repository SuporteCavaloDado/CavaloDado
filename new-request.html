<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Pedido - CavaloDado</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Botão voltar -->
    <button class="btn-back" onclick="window.history.back()">←</button>

    <!-- Header fixo -->
    <header class="header">
        <a href="index.html" class="logo">
            <img src="assets/logo.svg" alt="CavaloDado" style="height: 30px;">
        </a>
        <button class="menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <!-- Menu lateral -->
    <div class="menu-overlay"></div>
    <nav class="menu-sidebar">
        <div class="menu-header">
            <button class="menu-close">&times;</button>
        </div>
        <div class="menu-items">
            <a href="index.html" class="menu-item">Início</a>
            <a href="dashboard.html" class="menu-item">Perfil</a>
            <a href="new-request.html" class="menu-item">Novo Pedido</a>
            <a href="dashboard.html#historico" class="menu-item">Histórico</a>
            <a href="dashboard.html#progresso" class="menu-item">Progresso</a>
            <a href="dashboard.html#favoritos" class="menu-item">Favoritos</a>
            <a href="regras.html" class="menu-item">Termos e Regras</a>
            <a href="#" class="menu-item" onclick="logout()">Sair</a>
        </div>
    </nav>

    <!-- Conteúdo principal -->
    <main class="main-content">
        <div class="container">
            <div style="max-width: 600px; margin: 0 auto;">
                <div class="card">
                    <h1 class="text-center" style="color: var(--cor-secundaria); margin-bottom: 2rem;">Criar Novo Pedido</h1>

                    <div class="text-center" style="margin-bottom: 2rem; padding: 1rem; background: var(--cor-cinza-claro); border-radius: var(--border-radius);">
                        <p style="margin: 0; color: var(--cor-cinza-escuro);">
                            <strong>Limite:</strong> 1 pedido a cada 2 horas
                        </p>
                    </div>

                    <form id="novo-pedido-form">
                        <div class="form-group">
                            <label for="titulo" class="form-label">Nome do produto *</label>
                            <input type="text" id="titulo" class="form-input" maxlength="60" required>
                            <small style="color: var(--cor-cinza-escuro);">Máximo 60 caracteres</small>
                        </div>

                        <div class="form-group">
                            <label for="categoria" class="form-label">Categoria *</label>
                            <select id="categoria" class="form-select" required>
                                <option value="">Selecione uma categoria</option>
                                <!-- Opções removidas para compatibilidade: JS preenche dinamicamente via CATEGORIAS para evitar duplicação -->
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="descricao" class="form-label">Descrição do pedido *</label>
                            <textarea id="descricao" class="form-input" rows="4" required placeholder="Descreva por que você precisa deste produto e como ele irá ajudá-lo..."></textarea>
                        </div>

                        <!-- Foto do Pedido: Mantido e ajustado para compatibilidade com Supabase Storage; JS fará upload e salvará URL em nova coluna 'foto_url' na tabela 'pedidos' -->
                        <div class="form-group">
                            <label class="form-label">Foto do Pedido *</label>
                            <div class="upload-area">
                                <input 
                                    type="file" 
                                    id="foto-input" 
                                    accept="image/png, image/jpeg" 
                                    style="display: none;"
                                    required  <!-- Adicionado 'required' para alinhar com obrigatoriedade no Supabase -->
                                    onchange="
                                        if (this.files.length > 0) {
                                            document.getElementById('feedback-texto').innerHTML = this.files[0].name;
                                            document.getElementById('preview-container').style.borderColor = '#28a745';
                                        } else {
                                            document.getElementById('feedback-texto').innerHTML = 'Clique para anexar uma foto';
                                            document.getElementById('preview-container').style.borderColor = 'var(--cor-cinza-medio)';
                                        }
                                    "
                                >
                                <div 
                                    id="preview-container" 
                                    onclick="document.getElementById('foto-input').click()" 
                                    style="cursor: pointer; padding: 2rem; border: 2px dashed var(--cor-cinza-medio); border-radius: var(--border-radius); text-align: center; min-height: 150px; display: flex; align-items: center; justify-content: center;"
                                >
                                    <p id="feedback-texto">Clique para anexar uma foto</p>
                                </div>
                                <!-- Novo: Hidden para armazenar URL da foto após upload no JS -->
                                <input type="hidden" id="foto_url" name="foto_url">
                            </div>
                        </div>

                        <!-- Endereço: Removido qualquer hidden ou input; mantido apenas como mensagem estática, sem envio de dados para compatibilidade (endereco_entrega_id será tratado no JS via fetch de 'enderecos') -->
                        <div class="form-group">
                            <div style="padding: 1rem; background: var(--cor-cinza-claro); border-radius: var(--border-radius);">
                                <h4 style="margin-bottom: 0.5rem;">Endereço de entrega:</h4>
                                <p style="margin: 0; color: var(--cor-cinza-escuro);">
                                    O endereço cadastrado em suas configurações será usado para entrega.
                                    <a href="config.html" style="color: var(--cor-secundaria);">Verificar/Editar endereço</a>
                                </p>
                            </div>
                        </div>

                        <!-- Checkbox Termos: Mantido, mas para atualização em 'perfis.termos' via JS; não enviado para 'pedidos' -->
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="aceito-termos" required style="width: 25px; height: 25px;">
                                <label class="form-check-label" for="aceito-termos" style="color: #855404; font-size: 1.2rem;">Aceito os Termos e Regras *</label>
                            </div>
                        </div>

                        <!-- Novo: Hidden para status (compatibilidade com coluna 'status' em 'pedidos'; valor default 'pendente') -->
                        <input type="hidden" id="status" name="status" value="pendente">

                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            Criar Pedido
                        </button>
                    </form>
                </div>

                <!-- Anúncio -->
                <div class="anuncio" style="margin-top: 2rem;">
                    <img src="https://placehold.co/728x90?text=CavaloDado" alt="Anúncio Leaderboard">
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="supabase/supabase-config.js"></script>
    <script src="js/scripts.js"></script>
    
</body>
</html>
