<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - CavaloDado</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Botão voltar -->
    <button class="btn-back" onclick="window.history.back()">←</button>

    <!-- Header fixo -->
    <header class="header">
        <a href="index.html" class="logo">
            <img src="assets/logo.svg" alt="CavaloDado" style="height: 30px;">
        </a>
        <button class="menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </header>

    <!-- Menu lateral -->
    <div class="menu-overlay"></div>
    <nav class="menu-sidebar">
        <div class="menu-header">
            <button class="menu-close">&times;</button>
        </div>
        <div class="menu-items">
            <a href="index.html" class="menu-item">Início</a>
            <a href="dashboard.html" class="menu-item">Perfil</a>
            <a href="new-request.html" class="menu-item">Novo Pedido</a>
            <a href="dashboard.html#historico" class="menu-item">Histórico</a>
            <a href="config.html" class="menu-item">Configuração</a>
            <a href="regras.html" class="menu-item">Termos e Regras</a>
            <a href="#" class="menu-item" onclick="logout()">Sair</a>
        </div>
    </nav>

    <!-- Conteúdo principal -->
    <main class="main-content">
        <div class="container">
            <div style="max-width: 600px; margin: 0 auto;">
                <div class="card">
                    <h1 class="text-center" style="color: var(--cor-secundaria); margin-bottom: 2rem;">Configurações</h1>

                    <!-- Dados do perfil -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <h3 style="color: var(--cor-secundaria); margin-bottom: 1rem;">Dados do Perfil</h3>
                        
                        <form id="perfil-form">
                            <div class="form-group">
                                <label for="nome" class="form-label">Nome completo</label>
                                <input type="text" id="nome" class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="email" class="form-label">E-mail</label>
                                <input type="email" id="email" class="form-input" readonly>
                                <small style="color: var(--cor-cinza-escuro);">E-mail não pode ser alterado</small>
                            </div>

                            <div class="form-group">
                                <label for="username" class="form-label">Nome de usuário</label>
                                <input type="text" id="username" class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="bio" class="form-label">Bio</label>
                                <textarea id="bio" class="form-input" rows="3" placeholder="Conte um pouco sobre você..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                        </form>
                    </div>

                    <!-- Endereço -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <h3 style="color: var(--cor-secundaria); margin-bottom: 1rem;">Endereço de Entrega</h3>
                        <p style="color: var(--cor-cinza-escuro); margin-bottom: 1rem;">
                            Este endereço será usado para entrega dos produtos doados.
                        </p>
                        
                        <form id="endereco-form">
                            <div class="form-group">
                                <label for="cep" class="form-label">CEP *</label>
                                <input type="text" id="cep" class="form-input" placeholder="00000-000" maxlength="9" required>
                            </div>

                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="rua" class="form-label">Rua *</label>
                                    <input type="text" id="rua" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="numero" class="form-label">Número *</label>
                                    <input type="text" id="numero" class="form-input" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="complemento" class="form-label">Complemento</label>
                                <input type="text" id="complemento" class="form-input" placeholder="Apto, bloco, etc.">
                            </div>

                            <div class="form-group">
                                <label for="bairro" class="form-label">Bairro *</label>
                                <input type="text" id="bairro" class="form-input" required>
                            </div>

                            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label for="cidade" class="form-label">Cidade *</label>
                                    <input type="text" id="cidade" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="estado-endereco" class="form-label">Estado *</label>
                                    <select id="estado-endereco" class="form-select" required>
                                        <option value="" disabled selected>UF</option>
                                        <option value="AC">AC</option>
                                        <option value="AL">AL</option>
                                        <option value="AP">AP</option>
                                        <option value="AM">AM</option>
                                        <option value="BA">BA</option>
                                        <option value="CE">CE</option>
                                        <option value="DF">DF</option>
                                        <option value="ES">ES</option>
                                        <option value="GO">GO</option>
                                        <option value="MA">MA</option>
                                        <option value="MT">MT</option>
                                        <option value="MS">MS</option>
                                        <option value="MG">MG</option>
                                        <option value="PA">PA</option>
                                        <option value="PB">PB</option>
                                        <option value="PR">PR</option>
                                        <option value="PE">PE</option>
                                        <option value="PI">PI</option>
                                        <option value="RJ">RJ</option>
                                        <option value="RN">RN</option>
                                        <option value="RS">RS</option>
                                        <option value="RO">RO</option>
                                        <option value="RR">RR</option>
                                        <option value="SC">SC</option>
                                        <option value="SP">SP</option>
                                        <option value="SE">SE</option>
                                        <option value="TO">TO</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Salvar Endereço</button>
                        </form>
                    </div>

                <!-- Anúncio -->
                <div class="anuncio" style="margin-top: 2rem;">
                    <img src="https://placehold.co/728x90?text=Anuncio+Leaderboard" alt="Anúncio Leaderboard">
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase/supabase-config.js"></script>
    <script src="js/scripts.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Página config.html carregada');

        // Carregar dados
        if (typeof carregarPerfil === 'function') carregarPerfil();
        if (typeof carregarEndereco === 'function') carregarEndereco();

        // Máscara CEP
        document.getElementById('cep').addEventListener('input', function(e) {
            let valor = e.target.value.replace(/\D/g, '');
            valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = valor;
            console.log('CEP formatado:', e.target.value);
        });

        // Buscar CEP
        document.getElementById('cep').addEventListener('blur', function(e) {
            const cep = e.target.value.replace(/\D/g, '');
            console.log('Buscando CEP:', cep);
            if (cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        console.log('Resposta ViaCEP:', data);
                        if (!data.erro) {
                            document.getElementById('rua').value = data.logradouro || '';
                            document.getElementById('bairro').value = data.bairro || '';
                            document.getElementById('cidade').value = data.localidade || '';
                            document.getElementById('estado-endereco').value = data.uf || '';
                        } else {
                            alert('CEP inválido. Verifique o valor digitado.');
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao buscar CEP:', error);
                        alert('Erro ao buscar CEP. Verifique sua conexão.');
                    });
            }
        });

        // Salvar endereço
        document.getElementById('endereco-form').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Formulário de endereço enviado');
            if (typeof salvarEndereco === 'function') {
                salvarEndereco(e);
            } else {
                console.error('Função salvarEndereco não encontrada');
                alert('Função de salvar endereço não encontrada.');
            }
        });

        // Salvar perfil
        const perfilForm = document.getElementById('perfil-form');
        if (perfilForm) {
            perfilForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (typeof salvarPerfil === 'function') salvarPerfil(e);
            });
        }
    });
    </script>
</body>
</html>

